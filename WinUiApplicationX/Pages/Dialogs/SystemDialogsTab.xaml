<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="WinUiApplicationX.Pages.Dialogs.SystemDialogsTab"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WinUiApplicationX.Pages.Dialogs"
    xmlns:xu="using:MochaWinUI.Utils.Xaml"
    xmlns:uc="using:MochaWinUI.Utils.Xaml.UniversalConverter"
    xmlns:dm="using:ModelX.Dialogs"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <UserControl.Resources>
        <uc:UniversalConverter x:Key="CollectionLengthToVisibilityConverter">
            <uc:ConvertingRule Condition="{uc:NumberComparision IsGreaterThan=0}" Output="{uc:Collapsed}" />
            <uc:ConvertingRule Output="{uc:Visible}" />
        </uc:UniversalConverter>
        <uc:UniversalConverter x:Key="DialogTypeToGlyphConverter">
            <uc:ConvertingRule Condition="{uc:Enum Type=dm:SystemDialogType, Value=SaveDialog}" Output="&#xE74E;" />
            <uc:ConvertingRule Condition="{uc:Enum Type=dm:SystemDialogType, Value=OpenDialog}" Output="&#xED25;" />
            <uc:ConvertingRule Condition="{uc:Enum Type=dm:SystemDialogType, Value=BrowseDialog}" Output="&#xE838;" />
        </uc:UniversalConverter>

        <DataTemplate x:Key="DialogItemTemplate">
            <Grid Height="48">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <FontIcon FontSize="24" Glyph="&#xE74E;" />
                <TextBlock Grid.Column="1" Text="{Binding Name}" VerticalAlignment="Center" Margin="8,0,0,0" />
                <Button Grid.Column="2" Width="32" Height="32" CornerRadius="16" Padding="0">
                    <Button.Flyout>
                        <MenuFlyout Placement="BottomEdgeAlignedLeft">
                            <MenuFlyoutItem Text="Dispose" xu:ParentService.ParentType="SplitView" Command="{Binding ParentSource.DataContext.DisposeDialogCommand}" CommandParameter="{Binding OriginalSource}">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE74D;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Button.Flyout>
                    <FontIcon Glyph="&#xE712;" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5, 0.5">
                        <FontIcon.RenderTransform>
                            <RotateTransform Angle="90"/>
                        </FontIcon.RenderTransform>
                    </FontIcon>
                </Button>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>
    
    <SplitView DataContext="{x:Bind ViewModel}" IsPaneOpen="True" PanePlacement="Right">
        <SplitView.Pane>
            <Grid>
                <TextBlock Text="Pane 🐱‍🏍" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>
        </SplitView.Pane>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <ListView
                Padding="0,2,0,2"
                BorderThickness="1"
                BorderBrush="{ThemeResource FocusStrokeColorOuterBrush}"
                Width="400"
                MinHeight="400"
                ItemsSource="{Binding Dialogs}"
                SelectedItem="{Binding SelectedDialog}"
                ItemTemplate="{StaticResource DialogItemTemplate}"
                SelectionMode="Single"/>
            <TextBlock
                Text="No dialogs available"
                Visibility="{Binding Dialogs.Count, Converter={StaticResource CollectionLengthToVisibilityConverter}}"
                HorizontalAlignment="Center"
                Margin="8" />
            <Button
                Grid.Column="1"
                Margin="10,6,0,0"
                VerticalAlignment="Top"
                Width="42"
                Height="42"
                Command="{Binding CreateDialogCommand}"
                ToolTipService.ToolTip="Add dialog">
                <FontIcon FontSize="18" Glyph="&#xE710;" />
            </Button>
        </Grid>
    </SplitView>
</UserControl>
